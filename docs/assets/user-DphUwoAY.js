import{defineStore as o}from"pinia";import{getCurrentRoute as a,navigateTo as p}from"@browser-module/api/nav";const u=o("user",{state:()=>({payload:""}),actions:{async login(e,t){if(await d(e,t)){const s=c(e);return this.payload=s,!0}return!1},async logout(){this.payload=""},isGuest(){return!this.payload||this.isExpired()},isLogined(){return!!this.payload&&!this.isExpired()},getLogin(){if(this.isExpired())return"";const e=r(this.payload);return e?e.login:""},isAdmin(){if(this.isExpired())return!1;const e=r(this.payload);return e?e.permissions.includes("admin"):!1},getPermissions(){if(this.isExpired())return[];const e=r(this.payload);return e?e.permissions:[]},isExpired(){const e=r(this.payload);return e?e.exp<=Date.now():!0},getExpiredTime(){const e=r(this.payload);return e?e.exp:0},getExpiredInSeconds(){if(this.isExpired())return 0;const e=this.getExpiredTime(),t=Date.now(),n=Math.floor((e-t)/1e3);return n>0?n:0}},persist:!0});async function d(e,t){if(e===""||e!==t)return!1;const n=["account","rumors","app4","app5","app6","app7","app8","app9","app11","app12","app13","app14","app15","app16","app17","app18"];return e==="admin"&&n.push("admin"),console.log("Logged in as user with login",e,"userPermissions",n),!0}function c(e){const t={login:e,permissions:["account","rumors","app4","app5","app6","app7","app8","app9",...e==="admin"?["admin"]:[]],exp:Date.now()+6e5};return btoa(JSON.stringify(t))}function r(e){try{if(!e)return null;const t=atob(e);return JSON.parse(t)}catch(t){return console.error("Failed to decode payload",t),null}}console.log("[user.ts]");function i(){return u()}function f(){return i().isGuest()}function h(){return i().isLogined()}function m(){return i().isAdmin()}function y(){return i().getLogin()}async function x(e,t){return await i().login(e,t)}async function E(){await i().logout();const e=a().fullPath;e!=="/login"&&p({path:"/login",query:{back:e}})}function L(){return i().getPermissions()}function P(){return i().getExpiredInSeconds()}export{P as getExpiredInSeconds,y as getUserLogin,L as getUserPermissions,m as isAdmin,f as isGuest,h as isLogined,x as login,E as logout};
