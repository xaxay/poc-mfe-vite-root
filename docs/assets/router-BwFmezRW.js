import{createRouter as d,createWebHistory as m}from"vue-router";import u from"@browser-module/config/routes";import{isLogined as h}from"@browser-module/api/user";const f="/poc-mfe-vite-header/",a=d({history:m(f),routes:[]}),g=Object.entries(u.routes),n={};async function p(t){if(!n[t])try{n[t]=await import(t)}catch(i){throw console.error(`[dynamicImport] Failed: ${t}`,i),i}return n[t]}async function R(){console.log("[router.ts] initializing ...");const t=await Promise.all(g.map(async([e,r])=>{const o=await p(r.module),s={title:r.title,requiresAuth:r.requiresAuth===void 0||r.requiresAuth};if(o.createRouteChildren){const l=o.createRouteChildren(e);for(const c of l)c.meta={...s,...c.meta};return console.log(`[router.ts] route module with children loaded: ${e}`,l),{path:e,component:o.default,children:l}}return console.log(`[router.ts] route module loaded: ${e}`),{path:e,component:o.default,meta:s}})),i=u.defaultPath;if(i){const e={path:"/:pathMatch(.*)*",redirect:i};a.addRoute(e),console.log("[router.ts] default route:",e)}t.forEach(e=>a.addRoute(e)),a.beforeEach((e,r,o)=>{e.matched.length===0?(console.log("[router.ts] Unknown path:",e.path,"redirecting to default path:",u.defaultPath||"/"),o(u.defaultPath||"/")):e.meta.requiresAuth&&!h()?(console.log("[router.ts] Requires auth, redirecting to login, back-url:",e.fullPath),o({path:"/login",query:{back:e.fullPath}})):(console.log("[router.ts] Navigation from:",r.path,"to:",e.path),o())}),console.log("[router.ts] initialized",`
routes to add:`,t,`
router state:`,a.getRoutes())}await R();export{a as router};
